<!DOCTYPE html>
<html>
<head>
<title>ATK Technician Login</title>

<style>
html,body{
  margin:0;
  padding:0;
  width:100%;
  height:100%;
  font-family: Arial;
  overflow:hidden;
}

/* Video background */
#bgVideo{
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  object-fit: cover;
  z-index: -1;
}

/* Dark overlay */
.overlay{
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  background:rgba(0,0,0,0.6);
}

/* Login box */
.box{
  position:absolute;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  background:rgba(20,20,20,0.9);
  padding:35px;
  border-radius:12px;
  width:320px;
  color:white;
  box-shadow:0 0 40px black;
}

.box h2{ text-align:center; margin-bottom:20px; }

input{
  width:100%;
  padding:12px;
  margin-top:10px;
  border:none;
  border-radius:5px;
  font-size:15px;
}

button{
  width:100%;
  padding:12px;
  margin-top:15px;
  border:none;
  border-radius:5px;
  background:#4CAF50;
  color:white;
  font-size:16px;
  cursor:pointer;
}
</style>
</head>

<body>

<video autoplay muted loop id="bgVideo">
  <source src="lakzph.mp4" type="video/mp4">
</video>

<div class="overlay"></div>

<div id="techErrorBox" style="
display:none;
position:absolute;
top:20px;
left:50%;
transform:translateX(-50%);
background:#4fc3f7;
color:#00344f;
padding:12px 20px;
border-radius:8px;
font-weight:bold;
"></div>

<div class="box">
  <h2>Technician Login</h2>
  <input id="email" placeholder="Technician Email">
  <input id="password" type="password" placeholder="Password">
  <button onclick="techLogin()">Login</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyC3PzfKBSKGVnYjfwaeKxEMA-JJrmhNScw",
  authDomain: "atk-drone-service-portal.firebaseapp.com",
  projectId: "atk-drone-service-portal"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);

const email = document.getElementById("email");
const password = document.getElementById("password");

window.techLogin = async function(){
  try{
    if(!email.value || !password.value){
      showTechError("Enter email & password");
      return;
    }

    if(!email.value.toLowerCase().endsWith("@atk.com")){
      showTechError("Only ATK staff allowed");
      return;
    }

    const res = await signInWithEmailAndPassword(auth, email.value, password.value);
    const username = res.user.email.split("@")[0];

    // ðŸ”’ Technician whitelist
    if(username !== "lakz"){
      await signOut(auth);
      showTechError("Access denied â€” not technician");
      return;
    }

    // ðŸ” Create technician session (blocks direct URL access)
    sessionStorage.setItem("atkTech","1");

    window.location = "technician.html";
  }
  catch(err){
    console.error(err);
    showTechError("Login failed â€” check credentials");
  }
};

function showTechError(msg){
  const box = document.getElementById("techErrorBox");
  box.innerText = msg;
  box.style.display = "block";
  setTimeout(()=>{ box.style.display="none"; }, 3000);
}
</script>

</body>
</html>
